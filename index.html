<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Glossary Flashcards</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-top: 40px;
      color: #2d3a4b;
    }
    .flashcard {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      width: 350px;
      min-height: 180px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin: 0px 30px 20px 30px;
      padding: 32px 24px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: box-shadow 0.2s, transform 0.5s cubic-bezier(.4,2,.6,1), background 0.2s;
      transform-style: preserve-3d;
    }
    @media screen and (max-width: 429px) {
      .flashcard {
        width: 80%;
        margin: 0px auto;
        padding: 24px 16px;
      }
      .day-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 8px;
        margin-top: 10px;
        margin-bottom: 10px;
        max-width: 700px;
        width: 100%;
        box-sizing: border-box;
        padding: 0 10px;
      }
    }
    .flashcard:hover {
      box-shadow: 0 8px 32px rgba(0,0,0,0.16);
    }
    .controls {
      display: flex;
      gap: 16px;
      margin-bottom: 20px;
    }
    button {
      background: #2d3a4b;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 22px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #38b6ff;
    }
    .counter {
      color: #888;
      margin-bottom: 10px;
    }
    @media screen and (min-width: 429px) {
      .day-buttons {
        display: flex;
        gap: 8px;
        margin-top: 10px;
        margin-bottom: 10px;
        justify-content: center;
        flex-wrap: wrap;
        max-width: 700px;
      }
    }
    .day-btn {
      background: #2d3a4b;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 10px 16px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
      overflow: hidden;
    }
    .day-btn:hover {
      background: #38b6ff;
    }
    .inactive-btn {
      opacity: 0.5 !important;
      pointer-events: none !important;
    }
    @keyframes ripple-flashcard {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
    .day-btn-ripple {
      position: absolute;
      border-radius: 50%;
      transform: scale(0);
      animation: ripple-day-btn 0.5s linear;
      background: rgba(30,30,60,0.5);
      pointer-events: none;
      z-index: 2;
    }
    @keyframes ripple-day-btn {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }
    .flashcard.flipped {
      transform: rotateY(360deg);
      transform: rotateX(360deg);
    }
  </style>
</head>
<body>
  <h1 style="text-align: center;">Glossary Flashcards</h1>
  <div style="display: flex; text-align: center; flex-direction: column; align-items: center; margin-bottom: 10px; padding:0 10px;">
    <label for="calendar" style="font-size: 1rem; color: #2d3a4b; margin-bottom: 4px;">Select a date to view that week's glossary flashcards:</label>
    <input type="date" id="calendar" style="padding: 6px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 1rem;" />
    <div id="week-indicator" style="margin-top: 6px; color: #38b6ff; font-weight: bold;"></div>
  </div>
  <div class="day-buttons">
    <button class="day-btn" data-day="monday">Monday</button>
    <button class="day-btn" data-day="tuesday">Tuesday</button>
    <button class="day-btn" data-day="wednesday">Wednesday</button>
    <button class="day-btn" data-day="thursday">Thursday</button>
    <button class="day-btn" data-day="friday">Friday</button>
    <button class="day-btn" data-day="saturday">Saturday</button>
    <button class="day-btn" data-day="sunday">Sunday</button>
  </div>
  <div class="counter" id="counter"></div>
  <div style="display: flex; margin-top: 25px; justify-content: center; align-items: center; gap: 16px; margin-bottom: 4px;">
    <span id="front-label" style="font-weight: bold; color: #2d3a4b;">Front</span>
    <span id="back-label" style="font-weight: bold; color: #aaa;">Back</span>
  </div>
  <div class="flashcard" id="flashcard">Loading...</div>
  <div class="controls">
    <button id="prevBtn">Previous</button>
    <button id="flipBtn">Flip</button>
    <button id="nextBtn">Next</button>
  </div>
  <script>
    function loadLocalCSV() {
      fetch('glossary_words_py.csv')
        .then(response => {
          if (!response.ok) throw new Error('Local CSV not found');
          return response.text();
        })
        .then(csv => {
          window.latestCSV = csv;
          parseAndLoadCSV(csv);
        })
        .catch(error => {
          flashcard.textContent = 'Failed to load local CSV: ' + error;
        });
    }
    function getCurrentMondayISO() {
      const now = new Date();
      const day = now.getDay();
      const monday = new Date(now);
      monday.setDate(now.getDate() - ((day + 6) % 7));
      return monday.toISOString().split('T')[0];
    }
    function parseAndLoadCSV(csv) {
      window.latestCSV = csv;
      allCards = parseCSV(csv);
      minWeekStart = allCards.reduce((min, c) => !min || c.week_start < min ? c.week_start : min, null);
      maxWeekStart = allCards.reduce((max, c) => !max || c.week_start > max ? c.week_start : max, null);
      const currentMonday = getCurrentMondayISO();
      const weekExists = allCards.some(c => c.week_start === currentMonday);
      const defaultWeek = weekExists ? currentMonday : minWeekStart;
      calendar.value = new Date().toISOString().split('T')[0];
      setWeek(defaultWeek);
    }
    function parseCSV(text) {
      const lines = text.trim().split(/\r?\n/);
      const headers = lines[0].split(',');
      return lines.slice(1).map(line => {
        const values = [];
        let current = '', inQuotes = false;
        for (let i = 0; i < line.length; i++) {
          const char = line[i];
          if (char === '"') inQuotes = !inQuotes;
          else if (char === ',' && !inQuotes) { values.push(current); current = ''; }
          else current += char;
        }
        values.push(current);
        const obj = {};
        headers.forEach((h, i) => obj[h.trim()] = values[i] ? values[i].trim() : '');
        return obj;
      });
    }
    let allCards = [];
    let flashcardsByDay = {};
    let minWeekStart = null;
    let maxWeekStart = null;
    let currentDay = 'monday';
    let flashcards = [];
    let current = 0;
    let showingQuestion = true;
    const flashcard = document.getElementById('flashcard');
    const counter = document.getElementById('counter');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const flipBtn = document.getElementById('flipBtn');
    const dayBtns = document.querySelectorAll('.day-btn');
    const calendar = document.getElementById('calendar');
    const weekIndicator = document.getElementById('week-indicator');
    loadLocalCSV();
    function setWeek(weekStart) {
      const weekCards = allCards.filter(c => c.week_start === weekStart);
      const controls = [prevBtn, nextBtn, flipBtn, ...dayBtns];
      if (weekCards.length === 0) {
        controls.forEach(btn => { btn.disabled = true; btn.classList.add('inactive-btn'); });
        flashcards = [];
        weekIndicator.textContent = 'No data for this week.';
        updateFlashcard();
        return;
      } else {
        controls.forEach(btn => { btn.disabled = false; btn.classList.remove('inactive-btn'); });
      }
      flashcardsByDay = {monday:[],tuesday:[],wednesday:[],thursday:[],friday:[]};
      weekCards.forEach(c => {
        if (!flashcardsByDay[c.day]) flashcardsByDay[c.day] = [];
        flashcardsByDay[c.day].push({question: c.word, answer: c.meaning});
      });
      flashcardsByDay.saturday = [].concat(
        flashcardsByDay.monday,
        flashcardsByDay.tuesday,
        flashcardsByDay.wednesday,
        flashcardsByDay.thursday,
        flashcardsByDay.friday
      );
      flashcardsByDay.sunday = [...flashcardsByDay.saturday];
      currentDay = 'monday';
      flashcards = flashcardsByDay[currentDay];
      current = 0;
      weekIndicator.textContent = `Showing glossary flashcards for week: ${weekStart}`;
      updateFlashcard();
    }
    function updateFlashcard() {
      showingQuestion = true;
      if (!flashcards || flashcards.length === 0) {
        flashcard.textContent = 'No glossary words for this day!';
        counter.textContent = '';
        document.getElementById('front-label').style.color = '#2d3a4b';
        document.getElementById('back-label').style.color = '#aaa';
      } else {
        flashcard.textContent = flashcards[current].question;
        counter.textContent = `Card ${current + 1} of ${flashcards.length}`;
        document.getElementById('front-label').style.color = '#2d3a4b';
        document.getElementById('back-label').style.color = '#aaa';
      }
    }
    flashcard.onclick = function(e) {
      if (!flashcards || flashcards.length === 0) return;
      const rect = flashcard.getBoundingClientRect();
      const ripple = document.createElement('span');
      ripple.className = 'flashcard-ripple';
      const size = Math.max(rect.width, rect.height) * 1.2;
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
      ripple.style.top = (e.clientY - rect.top - size/2) + 'px';
      flashcard.appendChild(ripple);
      setTimeout(() => ripple.remove(), 500);
      showingQuestion = !showingQuestion;
      flashcard.classList.toggle('flipped', !showingQuestion);
      setTimeout(() => {
        flashcard.textContent = showingQuestion ? flashcards[current].question : flashcards[current].answer;
        document.getElementById('front-label').style.color = showingQuestion ? '#2d3a4b' : '#aaa';
        document.getElementById('back-label').style.color = showingQuestion ? '#aaa' : '#2d3a4b';
      }, 250);
    };
    flipBtn.onclick = flashcard.onclick;
    prevBtn.onclick = function() {
      if (!flashcards || flashcards.length === 0) return;
      current = (current - 1 + flashcards.length) % flashcards.length;
      updateFlashcard();
    };
    nextBtn.onclick = function() {
      if (!flashcards || flashcards.length === 0) return;
      current = (current + 1) % flashcards.length;
      updateFlashcard();
    };
    dayBtns.forEach(btn => {
      btn.onclick = function(e) {
        const rect = btn.getBoundingClientRect();
        const ripple = document.createElement('span');
        ripple.className = 'day-btn-ripple';
        const size = Math.max(rect.width, rect.height) * 1.2;
        ripple.style.width = ripple.style.height = size + 'px';
        ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
        ripple.style.top = (e.clientY - rect.top - size/2) + 'px';
        btn.appendChild(ripple);
        setTimeout(() => ripple.remove(), 500);
        currentDay = btn.getAttribute('data-day');
        flashcards = flashcardsByDay[currentDay] || [];
        current = 0;
        const weekStartMatch = weekIndicator.textContent.match(/week: (\d{4}-\d{2}-\d{2})/);
        if (weekStartMatch) {
          const weekStartStr = weekStartMatch[1];
          const weekStartDate = new Date(weekStartStr);
          const dayOffsets = {monday:0, tuesday:1, wednesday:2, thursday:3, friday:4, saturday:5, sunday:6};
          const offset = dayOffsets[currentDay] || 0;
          const newDate = new Date(weekStartDate);
          newDate.setDate(weekStartDate.getDate() + offset);
          calendar.value = newDate.toISOString().split('T')[0];
        }
        updateFlashcard();
      };
    });
    calendar.addEventListener('change', function() {
      const selectedDate = calendar.value;
      if (!selectedDate) return;
      const d = new Date(selectedDate);
      const day = d.getDay();
      const monday = new Date(d);
      monday.setDate(d.getDate() - ((day + 6) % 7));
      const weekStartStr = monday.toISOString().split('T')[0];
      if (weekStartStr < minWeekStart) {
        weekIndicator.textContent = `No data for this week. Earliest available: ${minWeekStart}`;
        flashcard.textContent = 'Cannot backdate that far!';
        counter.textContent = '';
        flashcards = [];
        disableAllControls();
        return;
      }
      if (weekStartStr > maxWeekStart) {
        weekIndicator.textContent = `No data for this week. Latest available: ${maxWeekStart}`;
        flashcard.textContent = 'This day is in the future. No words yet!';
        counter.textContent = '';
        flashcards = [];
        disableAllControls();
        return;
      }
      setWeek(weekStartStr);
    });
    function disableAllControls() {
      const controls = [prevBtn, nextBtn, flipBtn, ...dayBtns];
      controls.forEach(btn => { btn.disabled = true; btn.classList.add('inactive-btn'); });
    }
    function enableAllControls() {
      const controls = [prevBtn, nextBtn, flipBtn, ...dayBtns];
      controls.forEach(btn => { btn.disabled = false; btn.classList.remove('inactive-btn'); });
    }
  </script>
</body>
</html>
